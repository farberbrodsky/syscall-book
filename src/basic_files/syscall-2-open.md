# סיסקול 2 - open
```c
int open(const char *pathname, int flags)
int open(const char *pathname, int flags, mode_t mode)  // O_CREAT, O_TMPFILE
```

פותח את הקובץ שהשם שלו הוא pathname, ואם יש ב-flags את O_CREAT והקובץ לא קיים הוא גם יוצר קובץ חדש.

ב-flags אפשר להעביר bitwise or (דרך נחמדה להעביר מלא בוליאנים בכך שכל ביט במספר מתאר לנו בוליאן אחר, שנקרא flag במקרה הזה) של:
* O_APPEND: לפני כל כתיבה, לשים את המיקום של הכתיבות ממש על סוף הקובץ.
* O_CREAT: ליצור את הקובץ אם הוא לא קיים, אם יוצרים אז לפי ה-file access mode שמועבר ב-mode.
* O_EXCL: תוספת ל-O_CREAT (O_EXCL | O_CREAT) שאומרת שהקובץ חייב להיוצר ואחרת מוחזרת שגיאה.
* O_TRUNC: אם הקובץ כבר קיים ומותר לכתוב אליו אז התוכן שלו ימחק (גודל הקובץ ישונה ל-0).
* O_NONBLOCK: לפתוח את הקובץ במצב nonblocking אם אפשר. במצב nonblocking שום פעולה לא תגרום לפרוסס לחכות, פעולות מחזירות מיד את זה שצריך לחכות (errno EAGAIN/EWOULDBLOCK).
* O_SYNC: לפני שכל פעולת כתיבה חוזרת, לחכות עד שהמידע באמת יכתב לדיסק. בדרך כלל המידע יכול להגיע לbuffer ואם המחשב יכבה פתאומית זה לא בהכרח יכתב אלא אם נקרא ל-fsync.
* O_PATH: התוכן של הקובץ לא מעניין אותנו אבל אנחנו רוצים לעשות עליו פעולות כמו stat ולהיות בטוחים שהקובץ שאנחנו עובדים איתו לא השתנה בלי ששמנו לב (שיכול לקרות אם משתמשים ב-pathname כמה פעמים).
* O_TMPFILE: ליצור קובץ ללא שם. ב-pathname מעבירים שם של תיקיה שבה יווצר הקובץ. ברגע שסוגרים לגמרי קובץ חסר שם ואף אחד לא צריך אותו הוא נמחק, אבל אפשר לתת לו שם עם סיסקולים שנראה בעתיד (linkat). ההתנהגות שבה קובץ באמת נמחק רק אחרי שלגמרי מפסיקים להשתמש בו שימושית למקרה שמוחקים קובץ שכבר פתחנו - הקובץ לא באמת ימחק עד שלא נסגור אותו. הסיבות שנרצה להשתמש ב-O_TMPFILE הן בשביל לעשות הרבה פעולות על הקובץ לפני שיוכלו לראות אותו מבחוץ כמו למשל לשנות את הבעלים, או אם למשל אנחנו רוצים להוריד קובץ לדיסק (כי זיכרון זה משאב מוגבל) ולהשתמש בו אבל בלי שנצטרך למחוק אותו.
* O_DIRECTORY: להחזיר שגיאה אם pathname הוא לא תיקיה.

**למתקדמים (לא בקריאה הראשונה):**
* O_NOFOLLOW: לא לעקוב אחרי סימלינקים
* O_ASYNC: לשלוח סיגנל SIGIO בכל פעם שאפשר לקרוא או לכתוב לקובץ.
* O_CLOEXEC: הקובץ יסגר לקראת execve.

ועוד...

[עמוד ב-man](https://man7.org/linux/man-pages/man2/open.2.html)